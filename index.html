<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body onkeydown="drive(event)">
    <img src="images/background.jpg" class="background">
    <img src="images/wagon.png" class="wagon">
    <img src="images/sagradafamilia.png" class="sagrada-familia">
    <img src="images/top-tree.png" class="top-tree">
    <img src="images/torre.png" class="torre">
    <img src="images/arc.png" class="arc">
    <img src="images/mid-trees.png" class="mid-trees">
    <img src="images/bottom-tree.png" class="bottom-tree">
  </body>
</html>

<script>
  let wagon = document.querySelector('.wagon');
  const style = getComputedStyle(wagon);
  let positionLeft = style.left;
  let positionTop = style.top;

  function init() {
    wagon = document.querySelector(".wagon");
    wagon.style.position = "absolute";
    wagon.style.left = "0px";
    wagon.style.top = "200px";
  }


  function drive(e) {
    e.view.event.preventDefault();
    let positionLeft = getComputedStyle(wagon).left;
    let positionTop = getComputedStyle(wagon).top;
    if (positionTop == '200px') {
      road1(e);
    }
  }

  function road1(e) {
    position = getComputedStyle(wagon).transform;
    if (e.keyCode == 39 && position == 'matrix(-1, 0, 0, 1, 190, 190)') {
      console.log('stop');
    } else if (e.keyCode == 39) {
      let positionLeft = getComputedStyle(wagon).left;
      if (positionLeft == '660px') {
        diagonalRight();
      } else {
        moveRight();
      }
    } else if (e.keyCode == 37) {
      position = getComputedStyle(wagon).transform;
      if (position == 'matrix(-1, 0, 0, 1, 190, 190)') {
        document.addEventListener('keydown', road2);
      }
    }
  }


  function road2(e) {
    position = getComputedStyle(wagon).transform;
    positionTop = getComputedStyle(wagon).top;
    if (e.keyCode == 37 && position == 'matrix(-1, 0, 0, 1, -530, 430)' && positionTop == '400px') {
      wagon.style.transform = 'matrix(1, 0, 0, 1, -530, 430)';
      document.removeEventListener('keydown', road2);
      document.addEventListener('keydown', road3);
    } else if (e.keyCode == 37 && position == 'matrix(-1, 0, 0, 1, -530, 430)') {
      moveDown(e);
    } else if (e.keyCode == 37) {
      console.log('driving');
      stepx = stepx - 30;
      stepy = stepy + 10;
      wagon.style.transform = `translate(${stepx}px, ${stepy}px) scaleX(-1)`;
    }
  }

  function road3(e) {
    position = getComputedStyle(wagon).transform;
    if (e.keyCode == 37) {
      console.log('stop');
    } else if (e.keyCode == 39) {
      document.addEventListener('keydown', moveRight);
    }
  }


  // diagonals
  let stepy = 0;
  let stepx = 0;

  function diagonalRight(e) {
    stepx = stepx + 10;
    stepy = stepy + 10;
    wagon.style.transform = `translate(${stepx}px, ${stepy}px)`;

    let position = getComputedStyle(wagon).transform;
    if (position == 'matrix(1, 0, 0, 1, 190, 190)') {
      wagon.style.transform = `translate(${stepx}px, ${stepy}px) scaleX(-1)`;
    }
  }



  // moving
  function moveLeft(e) {
    let positionLeft = getComputedStyle(wagon).left;
    if (positionLeft == '0px') {
      console.log('stop');
    } else {
      wagon.style.left = parseInt(wagon.style.left) - 20 + "px";
    }
  }

  function moveRight(e) {
    wagon.style.left = parseInt(wagon.style.left) + 20 + "px";
  }

  function moveUp(e) {
    wagon.style.top = parseInt(wagon.style.top) - 20 + "px";
  }

  function moveDown(e) {
    wagon.style.top = parseInt(wagon.style.top) + 20 + "px";
  }

  window.onload = init;
</script>

<!-- road 1: -->
<!-- if left is less than 0, don't move -->
<!-- if top is higher than X or lower than Y, don't move -->
<!-- turning: if right is higher than X, flip and move diagonally -->
<!-- if top is lower than X, move left -->